---
tags:
  - этап1
  - done
---
Кортеж - это удобный синтаксис для объединения несколькких элементов в легковесной структуре.

```csharp
(double, int) t1 = (4.5, 3);
Console.WriteLine($"Tuple with elements {t1.Item1} and {t1.Item2}.");
// Output:
// Tuple with elements 4.5 and 3.

(double Sum, int Count) t2 = (4.5, 3);
Console.WriteLine($"Sum of {t2.Count} elements is {t2.Sum}.");
// Output:
// Sum of 3 elements is 4.5.
```

Чтобы объявить кортеж, нужно указать типы всех его членов и опционально, названия полей. На кортеже нельзя объявить [[методы]], но можно использовать предоставленные .NET:

```csharp
(double, int) t = (4.5, 3);
Console.WriteLine(t.ToString());
Console.WriteLine($"Hash code of {t} is {t.GetHashCode()}.");
// Output:
// (4.5, 3)
// Hash code of (4.5, 3) is 718460086.
```

Кортежи поддерживают [[Оператор равенства]] (подробнее в секции [[#равенство кортежей]]).

Кортежи - значимые типы, их элементы - публичные поля, что делает кортежи *изменяемыми* значимыми типами.

# использование кортежей

Часто кортежи применяются в качестве возвращаемого типа. Так, вместо использования `out` параметров, можно сгруппировать результаты метода в кортеж и вернуть его

```csharp
int[] ys = new int[] { -9, 0, 67, 100 };
var (minimum, maximum) = FindMinMax(ys);

(int min, int max) FindMinMax(int[] input)
{
	int min, max;
	// ...
	return (min, max);
}
```

# именованные поля

Объявляя кортеж, можно указать, как будут называться его поля:

```csharp
var t = (Sum: 4.5, Count: 3);
```

Если не указать название, оно может быть позаимствовано из переменных, из которых был создан кортеж.

Это не произойдёт в случае, если название переменной равно названию существующего члена кортежа, например (`Item3`, `ToString` или `Rest`). Тогда будет использовано название по умолчанию.

Начиная с C# 12 (.NET 8) можно указать алиас для кортежа используя директиву `using`:

```csharp
global using BandPass = (int Min, int Max);
```

После объявления алиаса можно использовать его как обычный тип при объявлении переменных:

```csharp
BandPass bracket = (40, 100);
Console.WriteLine($"The bandpass filter is {bracket.Min} to {bracket.Max}");
```

Разные алиасы с одинаковым количеством и типов элементов могут быть взаимозаменяемы. 

```csharp
using Range = (int Minimum, int Maximum);
Range r = bracket;
Console.WriteLine($"The range is {r.Minimum} to {r.Maximum}");
```
# присваивание и деконструкция

C# поддерживает присваивание между типами кортежей, которые соответствуют обоим условиям:

- оба типа должны содержать одинаковое количество полей
- для каждого поля тип правого кортежа должен совпадать или быть неявно переводимым в тип соответствующего поля в левом кортеже.

Присвоение происходит слева направо, имена полей при этом игнорируются.

Оператор `=` может быть использован для деконструкции кортежа в отдельные переменные.

```cs
var t = ("post office", 3.6);
var (destination, distance) = t;
```

# равенство кортежей

Операторы равенства (`==` и `!=`) сравнивают элементы левого кортежа с правым по порядку.

```csharp
(int a, byte b) left = (5, 10);
(long a, int b) right = (5, 10);
Console.WriteLine(left == right);  // output: True
Console.WriteLine(left != right);  // output: False

var t1 = (A: 5, B: 10);
var t2 = (B: 5, A: 10);
Console.WriteLine(t1 == t2);  // output: True
Console.WriteLine(t1 != t2);  // output: False
```

Два кортежа можно сравнить, если:

- Оба кортежа содержат одинаковое количество элементов.
- Для каждого поля кортежа, соответствующие элементы из левого и правого кортежа должны поддерживать [[операторы сравнения]].

# использование кортежей в качестве `out` параметров

Обычно метод с `out` параметрами рефакторится в метод, который возвращает кортеж, но бывают случаи, когда параметр `out` может быть кортежем:

```csharp
var limitsLookup = new Dictionary<int, (int Min, int Max)>()
{
    [2] = (4, 10),
    [4] = (10, 20),
    [6] = (0, 23)
};

if (limitsLookup.TryGetValue(4, out (int Min, int Max) limits))
{
    Console.WriteLine($"Found limits: min is {limits.Min}, max is {limits.Max}");
}
// Output:
// Found limits: min is 10, max is 20
```

# кортежи vs `System.Tuple`

Кортежи в C# используют тип `System.ValueTuple`, но ещё существует `System.Tuple`, который отличается от обычного кортежа:

- `System.ValueType` - значимый тип. `System.Tuple` - ссылочный тип
- `System.ValueType` - изменяемые. `System.Tuple` - нет
- Члены `System.ValueType` - поля. Члены `System.Tuple` же - свойства