---
stage: 2
status: todo
---
По сути это хеш таблица:
- `_buckets: int[]` - Массив, где индекс - это номер корзины (рассчитанный на основе хеш-кода ключа), а значение - это **1-based индекс** (то есть индекс + 1) в массиве `_entries`, указывающий на первую запись в цепочке для этой корзины. Значение `0` означает пустую корзину.
- `_entries: Entry[]` - где хранятся все данные (в т. ч. удалённые)
- `_freeList: int` - индекс в `_entries`, с которого начинаются удалённые записи
- `_freeCount: int` - количество удалённых записей
- `_count: int` - общее количество записей, включая удалённые

# Процесс добавления записи

1. Вычисление хеш-кода через `comparer.GetHashCode(TKey)`
2. Операцией модуля вычисляется индекс бакета, в который будет отправлен элемент
3. Затем в бакете производится поиск ключа (сначала по хеш-кодам, затем точно по ключу)
4. Разрешение коллизий
	1. Если ключ найден, поведение зависит от `InsertionBehavior` (перезаписать или выбросить исключение)
	2. Если ключ не найден, элемент добавляется в цепочку
5. Добавление записей
	1. Сначала проверяется `_freeList`. Если есть удалённые записи, первая из них переиспользуется
	2. Если удалённых записей нет, элемент добавляется в конец массива `_entries`
	3. Новый элемент становится головой цепочки