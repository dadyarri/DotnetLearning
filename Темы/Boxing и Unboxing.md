---
tags:
  - этап1
---
# боксинг

Боксинг - неявный процесс конвертации [значимого типа](Value%20типы) в тип [[object]] или в любой интерфейс, реализованный этим значимым типом. Когда рантайм боксит значимый тип, он оборачивает значение внутри в объект `System.Object` и копирует его в управляемую кучу.

```cs
int i = 123;
// The following line boxes i.
object o = i;
```

В результате этого выражения на стеке создаётся ссылка на объект `o`, которая ссылается на значение типа `int` в куче. Это значение - копия значения значимого типа, присвоенного в переменную `i`:

![[boxing-operation-i-o-variables.gif]]

# анбоксинг

Анбоксинг - это явный процесс извлечения значимого типа из объекта (конвертация). Он состоит из:
- проверки, что объект является боксированным значением данного значимого типа
- копирования значения из объекта в переменную значимого типа.

```cs
o = 123;
i = (int)o;  // unboxing
```


![[unboxing-conversion-operation.gif]]

Чтобы анбоксинг не вызывал ошибок в рантайме, элемент, который подвергается анбоксу должен быть ссылкой на объект, который до этого был создан боксингом объекта этого же значимого типа. Попытка анбокса `null` приведёт к `NullReferenceException`. Попытка анбокса ссылки несовместимого типа приведёт к `InvalidCastException`.
# производительность

Относительно простых выражений, боксинг и анбоксинг довольно трудоёмкие процессы. Когда боксится значимый тип, новый объект должен быть аллоцирован и собран. В меньшей степени, приведение типов, необходимое для анбоксинга, тоже вычислительно сложное.